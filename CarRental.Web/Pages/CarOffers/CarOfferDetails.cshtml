@page "/caroffers/{urlHandle}"
@using Microsoft.AspNetCore.Identity
@using CarRental.Web.Models.Domain.CarOffer
@model CarRental.Web.Pages.CarOffers.CarOfferDetails
@inject UserManager<IdentityUser> UserManager
@inject SignInManager<IdentityUser> SignInManager
@{

}

<!DOCTYPE html>
<div class="container mt-5">
<div class="row justify-content-center">
<div class=" col-8 ">
    <div class="me-4">
        <div class="d-flex mb-2  justify-content-start align-items-center">
            <a href="/caroffers/caroffersmain" style="color: inherit;text-decoration: inherit;">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-arrow-left-square me-3" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm11.5 5.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
                </svg>
            </a>
            <div class="">
                <h1>@Model.CarOffer.Heading</h1>
            </div>
        </div>
        <div class="mb-4" style="width: 100%;">
            <img id="mainImage" src="@Model.CarOffer.ImageUrls.First().Url" class="img-fluid" style=" display: inline-block;border-radius: 20px!important;" alt=""> @*style="max-width: 100%;height: auto;object-fit: cover;" *@
        </div>
        <div id="imageGallery" class="image-gallery row justify-content-start mb-5" style="width: 100%!important;overflow-x: auto!important;white-space: nowrap!important;">
            @foreach (var imgUrl in Model.CarOffer.ImageUrls)
            {
                <a href="" class="col-3 mb-4" style="display: inline-block">
                    <div style="border-radius: 10px!important;" class="card  me-1 bg-body-tertiary border border-0 h-100 ">
                        <img style="border-radius: 7px!important;display: inline-block!important;" src="@imgUrl.Url" class="card-img-top galleryImageS" alt=""> @*style="max-width: 100%;height: auto;object-fit: cover;" *@
                    </div>
                </a>
            }
        </div>
        <h2 class="mb-4">Opis i dane techniczne</h2>
        <div class="row justify-content-start mb-5">
            <div class="pe-2 col">
                <div class="p-3 justify-content-center" style="background-color: #f0f3f8; border-radius: 10px">
                    <div class="row mb-2 ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-calendar" viewBox="0 0 16 16">
                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                        </svg>
                    </div>
                    <div class="d-flex text-nowrap justify-content-center" style="font-size: 13px">
                        <span >Year of Production</span>
                    </div>
                    <div class="d-flex justify-content-center" style="font-size: 14px">
                        <span class="fw-bolder">@Model.CarOffer.YearOfProduction</span>
                    </div>
                </div>
            </div>
            <div class="pe-2 col">
                <div class="p-3 justify-content-center" style="background-color: #f0f3f8; border-radius: 10px">
                    <div class="row mb-2 ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-fire" viewBox="0 0 16 16">
                            <path d="M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16Zm0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15Z"/>
                        </svg>
                    </div>
                    <div class="d-flex justify-content-center text-nowrap" style="font-size: 13px">
                        <span >Engine capacity</span>
                    </div>
                    <div class="d-flex justify-content-center" style="font-size: 14px">
                        <span class="fw-bolder">@Model.CarOffer.EngineDetails</span>
                    </div>
                </div>
            </div>
            <div class="pe-2 col">
                <div class="p-3 justify-content-center" style="background-color: #f0f3f8; border-radius: 10px">
                    <div class="row mb-2 ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-speedometer2" viewBox="0 0 16 16">
                            <path d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z"/>
                            <path fill-rule="evenodd" d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A7.988 7.988 0 0 1 0 10zm8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3z"/>
                        </svg>
                    </div>
                    <div class="d-flex justify-content-center text-nowrap" style="font-size: 13px">
                        <span >Horsepower</span>
                    </div>
                    <div class="d-flex justify-content-center " style="font-size: 14px">
                        <span class="fw-bolder">@Model.CarOffer.Horsepower</span>
                    </div>
                </div>
            </div>
            <div class="pe-2 col">
                <div class="p-3 justify-content-center" style="background-color: #f0f3f8; border-radius: 10px">
                    <div class="row mb-2 ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                    </div>
                    <div class="d-flex justify-content-center text-nowrap" style="font-size: 13px">
                        <span >Gearbox type</span>
                    </div>
                    <div class="d-flex justify-content-center" style="font-size: 14px">
                        <span class="fw-bolder">@Model.CarOffer.GearboxDetails</span>
                    </div>
                </div>
            </div>
            <div class="pe-2 col">
                <div class="p-3 justify-content-center" style="background-color: #f0f3f8; border-radius: 10px">
                    <div class="row mb-2 ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        </svg>
                    </div>
                    <div class="d-flex justify-content-center" style="font-size: 13px">
                        <span >Drivetrain</span>
                    </div>
                    <div class="d-flex justify-content-center" style="font-size: 14px">
                        <span class="fw-bolder">@Model.CarOffer.DriveDetails</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="border border-start-0 border-end-0 ">
            <div class="my-4">
                <p>@Model.CarOffer.ShortDescription</p>
            </div>
        </div>
        <div class="my-5">
            <table class="table table-bordered">
                <thead class="table-dark">
                <tr>
                    <th scope="col">Time</th>
                    <th scope="col">Price</th>
                </tr>
                </thead>
                <tbody class="table-group-divider">
                <tr>
                    <td>Day (mon. - thu.)</td>
                    <td>@Model.CarOffer.Tarrifs.OneNormalDayPrice usd</td>
                </tr>
                <tr>

                    <td>Day of the weekend (fri. - sun.)</td>
                    <td>@Model.CarOffer.Tarrifs.OneWeekendDayPrice usd</td>
                </tr>
                <tr>
                    <td>Weekend (fri. 16:00 - sun. 10:00)</td>
                    <td>@Model.CarOffer.Tarrifs.FullWeekendPrice usd</td>
                </tr>
                <tr>
                    <td>Week</td>
                    <td>@Model.CarOffer.Tarrifs.OneWeekPrice usd</td>
                </tr>
                <tr>
                    <td>Month</td>
                    <td>@Model.CarOffer.Tarrifs.OneMonthPrice usd</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div style="border-radius: 15px!important;height: 10%!important" class="card w-full col-lg-4 col-md-4 col-sm-12 pt-3 ps-4 pe-4 pb-3 border border-dark shadow">
    <form method="post">
        <div class="mb-2">
            <h4 > Rezerwuj</h4>
        </div>
        <div class="mb-2">
            <h3 > Dostępność</h3>
        </div>
        <div class="row justify-content-center mx-1 mb-4">
            <input type="Date" class="form-control me-1 col" id="startDate" asp-for="CarOrderSmall.StartDate"/>
            <input type="Date" class="form-control ms-1 col" id="endDate" asp-for="CarOrderSmall.EndDate"/>
        </div>
        <div class="mb-2">
            <h3 > Kierowcy</h3>
        </div>
        <div class="fw-lighter mb-1 ms-1">Number-of-drivers</div>
        <div class="row d-flex justify-content-center mx-2 ms-1 mb-1">
            <button id="numberOfDriversDecr" class="btn p-0 col-2 me-2 d-block border border-secondary-subtle">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-dash-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                </svg>
            </button>
            <input value="1" class="form-control ps-6 pe-6  col border border-secondary-subtle" id="numberOfDrivers" asp-for="CarOrderSmall.NumOfDrivers"/>
            <button id="numberOfDriversIncr" class="btn p-0 col-2 ms-2 d-block border border-secondary-subtle">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
            </button>
        </div>
        <div class="fw-lighter mb-4 ms-1">The additional driver surcharge is 200 PLN.</div>
        <div class="mb-2 ms-1">
            <h3> General Terms and Conditions</h3>
        </div>
        <div class="fw-lighter mb-1 ms-1"><i class="bi bi-bookmark-check me-1"></i>The security deposit - 1500 PLN.</div>
        <div class="fw-lighter mb-1 ms-1"><i class="bi bi-bookmark-check me-1"></i>Daily mileage limit: 300 km.</div>
        <div class="fw-lighter mb-1 ms-1"><i class="bi bi-bookmark-check me-1"></i>The fee for exceeding the mileage limit is 2 PLN/KM.</div>
        <div class="grid d-flex justify-content-between mb-4">
            <div class="g-col-6 d-flex align-items-center">
                <div class="d-flex">Rent price</div>
            </div>
            <div class="g-col-6 ">
                <span class="fw-bold"><span id="totalPrice" class="fs-3">0</span> usd </span>
                <div class="fw-lighter  text-end">gross</div>
            </div>
        </div>
        @if (SignInManager.IsSignedIn(User))
        {
            <button style="border-radius: 19px!important;" type="submit" class="col-12 btn btn-danger border-0 ms fs-5 mb-2">
                book
            </button>
        }
        else
        {
            <button style="border-radius: 19px!important;" type="submit" class="col-12 btn btn-danger border-0 ms fs-5 mb-2 disabled">
                book
            </button>
        }

    </form>
</div>
<div class="w-full">

</div>
</div>
</div>

@section Scripts {
    <script>
    $(document).ready(function () {
            var driverSurcharge = 200;
            var numberOfDriversInput = $("#numberOfDrivers");
            var rentalPricePerDay = @Model.CarOffer.Tarrifs.OneNormalDayPrice;
            var startDateInput = $("#startDate");
            var endDateInput = $("#endDate");
            var galleryContainer = $('#imageGallery');
            var mainImage = $('#mainImage');
            
            
            $('.card-img-top.galleryImageS').on('click',function(event) {
                event.preventDefault();
                console.log($(this))
                 var newImageSrc = event.target.getAttribute('src');
                 mainImage.attr('src', newImageSrc);
            })
            
           function calculateTotalPrice() {
                var startDate = new Date(startDateInput.val());
                var endDate = new Date(endDateInput.val());
                var numOfDrivers = parseInt(numberOfDriversInput.val());
                var numberOfDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                if(numOfDrivers>=1 && numberOfDays >= 1){
                    var totalPrice = (numberOfDays * rentalPricePerDay) + driverSurcharge * (numOfDrivers-1);
                    $("#totalPrice").text(totalPrice);
                }else{
                    $("#totalPrice").text(0);
                }
           }
            
           startDateInput.on("input", calculateTotalPrice);
           endDateInput.on("input", calculateTotalPrice);
    
            $('#numberOfDriversDecr').on('click',function(e){
                    e.preventDefault();
                    var currentValue = parseInt($("#numberOfDrivers").val());
                    var newValue = currentValue - 1;
                    $("#numberOfDrivers").val(newValue);
                    calculateTotalPrice();
                });
    
            $('#numberOfDriversIncr').on('click',function(e){
                    e.preventDefault();
                    var currentValue = parseInt($("#numberOfDrivers").val());
                    var newValue = currentValue + 1;
                    $("#numberOfDrivers").val(newValue);
                    calculateTotalPrice();
                });
    
            
        });
            
        </script>
}